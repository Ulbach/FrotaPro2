
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard — Frota Pro</title>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#0b0f17; --bg2:#0f1420; --glass:#101826cc; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
    --accent:#16a34a; --accent-2:#0ea5e9; --warn:#ef4444; --border:#1f2937; --ring:#22c55e44;
    --shadow:0 20px 60px rgba(0,0,0,.45);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg) 0%,var(--bg2) 100%);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1200px;margin:28px auto;padding:0 14px}

  /* HEADER */
  .hero{
    position:relative; overflow:hidden; border-radius:26px; padding:22px 18px;
    background: radial-gradient(1200px 520px at -10% -10%, #22c55e22 0%, transparent 60%),
                radial-gradient(1200px 520px at 120% -20%, #06b6d422 0%, transparent 60%),
                linear-gradient(180deg,#0f172a 0%, #0b1220 100%);
    box-shadow: var(--shadow); border:1px solid #162033;
  }
  .hero::after{ /* brilho sutil passando */
    content:""; position:absolute; inset:-50%; background:conic-gradient(from 90deg,transparent 0 75%, #ffffff0f 75% 100%);
    animation:shine 6s linear infinite; filter:blur(20px); opacity:.25;
  }
  @keyframes shine{to{transform:rotate(360deg)}}
  .title{display:flex;align-items:center;gap:12px;position:relative;z-index:1}
  .badge{display:inline-flex;gap:8px;align-items:center;font-weight:800;font-size:12px;
         letter-spacing:.12em;padding:6px 10px;border-radius:999px;background:#16a34a22;border:1px solid #16a34a55;color:#34d399}
  h1{margin:0;font-size:28px;letter-spacing:.18em}

  /* CONTROLS */
  .controls{
    margin-top:12px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    position:relative; z-index:1;
  }
  select{
    appearance:none; background:#0f172a; color:var(--text); border:1px solid #243249; border-radius:12px;
    padding:10px 36px 10px 12px; position:relative; outline:none; box-shadow:inset 0 0 0 1px #00000033;
  }
  .btn{
    display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #243249;
    color:#fff;background:linear-gradient(180deg,#16a34a 0%,#128c3f 100%);font-weight:800;cursor:pointer;
    box-shadow:0 6px 18px #16a34a33; transition:.2s transform,.2s filter;
  }
  .btn:hover{transform:translateY(-1px);filter:brightness(1.08)}
  .btn.alt{background:linear-gradient(180deg,#0ea5e9 0%,#0584bb 100%); box-shadow:0 6px 18px #0ea5e933}
  .btn.ghost{background:#0f172a;border:1px solid #243249}
  .status{margin-left:auto;color:var(--muted);font-weight:700}

  /* GRID / CARDS */
  .grid{display:grid;gap:14px;margin-top:14px}
  @media (min-width:980px){
    .grid.kpis{grid-template-columns:1fr 1fr 1fr}
    .grid.twos{grid-template-columns:1fr 1fr}
  }
  .card{
    background:linear-gradient(180deg,#0b1221 0%, #0b12210a 100%); border:1px solid #1d2940; border-radius:var(--radius);
    box-shadow:var(--shadow); padding:14px; position:relative; overflow:hidden;
  }
  .card::before{ /* glow na borda ao focar/hover */
    content:""; position:absolute; inset:0; border-radius:var(--radius); pointer-events:none;
    box-shadow:inset 0 0 0 1px transparent; transition:.25s;
  }
  .card:hover::before{ box-shadow:inset 0 0 0 1px var(--ring) }

  /* KPI */
  .kpi{display:flex;flex-direction:column;gap:8px}
  .kpi .label{color:var(--muted);font-weight:900;letter-spacing:.14em}
  .kpi .value{font-size:34px;font-weight:900}
  .kpi .hint{color:var(--muted);font-size:12px}

  /* SKELETON shimmer */
  .skeleton{position:relative;overflow:hidden;background:#0f172a}
  .skeleton::after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg, transparent 0%, #ffffff0d 50%, transparent 100%);
    animation:shimmer 1.6s infinite; transform:translateX(-100%);
  }
  @keyframes shimmer{to{transform:translateX(100%)}}

  /* TABLE */
  .table-wrap{overflow:auto; border-radius:12px; border:1px solid #1d2940}
  table{width:100%;border-collapse:collapse;background:#0b1221}
  th,td{padding:10px;border-bottom:1px solid #152036}
  th{color:#9fb0cc;text-align:left;letter-spacing:.12em;font-size:12px}
  td{color:#d6e0f0}
  tr:hover td{background:#0f172a}

  /* FILTER */
  .filter{display:flex;align-items:center;gap:8px;margin:10px 0 0}
  .filter input{
    width:260px;background:#0f172a;border:1px solid #243249;border-radius:10px;color:#e5e7eb;padding:8px 10px;outline:none;
  }

  /* MODAL */
  .modal-backdrop{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(2,6,23,.55); backdrop-filter:blur(8px); z-index:40;
    animation:fadeIn .2s ease-out;
  }
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  .modal{
    width:min(720px,92vw); background:#0b1221; border:1px solid #1d2940; border-radius:18px; box-shadow:var(--shadow);
    transform:scale(.95); opacity:0; animation:pop .18s ease-out forwards;
  }
  @keyframes pop{to{transform:scale(1);opacity:1}}
  .modal-head{display:flex;align-items:center;gap:12px;padding:14px;border-bottom:1px solid #152036}
  .modal-title{font-weight:900;letter-spacing:.14em}
  .modal-body{padding:14px}
  .modal-actions{display:flex;justify-content:flex-end;gap:10px;padding:14px;border-top:1px solid #152036}
  .chip{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid #243249;background:#0f172a;color:#9fb0cc;font-weight:800}

  /* SMALL BADGES */
  .badge-km{background:#0ea5e922;border-color:#0ea5e955;color:#7dd3fc}
  .badge-trips{background:#16a34a22;border-color:#16a34a55;color:#86efac}
  .badge-rank{background:#7c3aed22;border-color:#7c3aed55;color:#d8b4fe}
</style>
</head>
<body>
<div class="wrap">

  <!-- HERO -->
  <section class="hero">
    <div class="title">
      <div class="badge">DASHBOARD</div>
      <h1>FROTA PRO</h1>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
      <label class="chip" for="selMes">Mês</label>
      <select id="selMes" aria-label="Mês">
        <option value="1">Jan</option><option value="2">Fev</option><option value="3">Mar</option><option value="4">Abr</option>
        <option value="5">Mai</option><option value="6">Jun</option><option value="7">Jul</option><option value="8">Ago</option>
        <option value="9">Set</option><option value="10">Out</option><option value="11">Nov</option><option value="12">Dez</option>
      </select>

      <label class="chip" for="selAno">Ano</label>
      <select id="selAno" aria-label="Ano"></select>

      <button id="btnAtualizar" class="btn" title="Atualizar métricas">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="#fff" stroke-width="2" stroke-linecap="round"/><path d="M21 5v6h-6" stroke="#fff" stroke-width="2" stroke-linejoin="round"/></svg>
        Atualizar
      </button>

      <a href="./" class="btn alt" title="Voltar ao App">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Voltar ao App
      </a>

      <button id="btnExport" class="btn ghost" title="Exportar gráficos (PNG)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5v10M5 12l7 7 7-7" stroke="#9fb0cc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Exportar PNG
      </button>

      <div id="status" class="status">Pronto</div>
    </div>
  </section>

  <!-- KPIs -->
  <section class="grid kpis">
    <div id="kpiTripsCard" class="card kpi skeleton">
      <div class="label">VIAGENS</div>
      <div id="kpiTrips" class="value">0</div>
      <div class="hint">Total de viagens concluídas no mês</div>
    </div>
    <div id="kpiKmCard" class="card kpi skeleton">
      <div class="label">KM RODADOS</div>
      <div id="kpiKm" class="value">0</div>
      <div class="hint">Soma dos Km rodados (entradas)</div>
    </div>
    <div id="kpiAvgCard" class="card kpi skeleton">
      <div class="label">MÉDIA KM/VIAGEM</div>
      <div id="kpiAvg" class="value">0</div>
      <div class="hint">Km / viagens no período</div>
    </div>
  </section>

  <!-- CHARTS TOP -->
  <section class="grid twos">
    <div id="c1" class="card skeleton"><canvas id="chartTripsByVehicle" height="220"></canvas></div>
    <div id="c2" class="card skeleton"><canvas id="chartKmByVehicle" height="220"></canvas></div>
  </section>

  <!-- CHARTS BOTTOM -->
  <section class="grid">
    <div id="c3" class="card skeleton"><canvas id="chartByDay" height="260"></canvas></div>
    <div id="c4" class="card skeleton"><canvas id="chartShare" height="260"></canvas></div>
  </section>

  <!-- TABELA -->
  <section class="card" style="margin-top:14px">
    <div class="label" style="margin-bottom:6px">DETALHE POR VEÍCULO</div>
    <div class="filter">
      <input id="filtro" type="text" placeholder="Filtrar por veículo..." />
      <span class="muted">Clique na linha para abrir detalhes</span>
    </div>
    <div class="table-wrap" style="margin-top:8px">
      <table id="tbl">
        <thead><tr>
          <th>Veículo</th><th style="text-align:right">Viagens</th><th style="text-align:right">Km</th><th style="text-align:right">Km/Viagem</th>
        </tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>

</div>

<!-- MODAL -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document">
    <div class="modal-head">
      <div class="modal-title">Detalhe do Veículo</div>
      <div id="modalTitle" class="chip" style="margin-left:8px"></div>
      <div style="margin-left:auto"></div>
      <button id="btnClose" class="btn ghost" aria-label="Fechar">Fechar</button>
    </div>
    <div class="modal-body">
      <div class="grid twos">
        <div class="card">
          <div class="label">RESUMO</div>
          <div id="mResumo" class="muted" style="margin-top:8px"></div>
        </div>
        <div class="card">
          <div class="label">INDICADORES</div>
          <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
            <div id="mTrips" class="chip badge-trips"></div>
            <div id="mKm" class="chip badge-km"></div>
            <div id="mAvg" class="chip"></div>
            <div id="mRankTrips" class="chip badge-rank"></div>
            <div id="mRankKm" class="chip badge-rank"></div>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top:12px">
        <div class="label">OBSERVAÇÕES</div>
        <div class="muted" style="margin-top:6px">Este modal exibe estatísticas do mês corrente selecionado. Para histórico diário por veículo, podemos adicionar uma rota opcional no backend se desejar.</div>
      </div>
    </div>
    <div class="modal-actions">
      <button id="btnClose2" class="btn ghost">Fechar</button>
    </div>
  </div>
</div>

<script>
/* ================== CONFIG ================== */
const API_URL = 'https://script.google.com/macros/s/AKfycbwE8F061OhUN5lTom2nZ0W_Vm5LX2wAWhPE4rtd6umbaxcIdmjaAzEtlf-wOHVpgDl-4g/exec';

/* ================== STATE ================== */
let charts = { trips:null, km:null, daily:null, share:null };
let metricsCache = null; // mantém as métricas do último fetch p/ drill-down
let byVehicleRanks = { byKm:[], byTrips:[] };

/* ================== HELPERS ================== */
const fmt = new Intl.NumberFormat('pt-BR');
const qs = (id) => document.getElementById(id);
function setStatus(s){ qs('status').textContent = s||''; }

function animateCount(el, to, duration=650){
  const from = Number(el.textContent.replace(/[^\d.-]/g,'')) || 0;
  const start = performance.now();
  const step = (now)=>{
    const t = Math.min(1, (now-start)/duration);
    const val = Math.round((from + (to-from)*t)*100)/100;
    el.textContent = fmt.format(val);
    if(t<1) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

function grad(ctx, c1, c2){
  const g = ctx.createLinearGradient(0,0,0,300);
  g.addColorStop(0, c1); g.addColorStop(1, c2);
  return g;
}

/* ================== API ================== */
async function fetchMetrics(y,m){
  setStatus('Carregando...');
  const url = `${API_URL}?route=metrics&year=${y}&month=${m}&t=${Date.now()}`;
  const res = await fetch(url, { method:'GET' });
  const txt = await res.text().catch(()=> ''); let json={}; try{ json=JSON.parse(txt);}catch{}
  if(!res.ok || json?.ok===false) throw new Error(json?.error || txt || 'Falha ao obter métricas');
  setStatus(`Período: ${String(m).padStart(2,'0')}/${y}`);
  return json;
}

/* ================== RENDER ================== */
function destroyCharts(){
  Object.keys(charts).forEach(k=>{ try{ charts[k]?.destroy(); }catch(_){} charts[k]=null; });
}

function removeSkeleton(){
  ['kpiTripsCard','kpiKmCard','kpiAvgCard','c1','c2','c3','c4'].forEach(id=> qs(id).classList.remove('skeleton'));
}

function renderKPIs(totals){
  animateCount(qs('kpiTrips'), totals?.viagens || 0);
  animateCount(qs('kpiKm'), totals?.kmRodados || 0);
  const avg = (totals?.viagens ? (totals.kmRodados/totals.viagens) : 0);
  animateCount(qs('kpiAvg'), Math.round(avg*100)/100);
}

function renderCharts(metrics){
  const tripsTop = metrics.topVehiclesByTrips || [];
  const kmTop    = metrics.topVehiclesByKm || [];
  const byDay    = metrics.byDay || [];
  const ctxTrips = qs('chartTripsByVehicle').getContext('2d');
  const ctxKm    = qs('chartKmByVehicle').getContext('2d');
  const ctxDaily = qs('chartByDay').getContext('2d');
  const ctxShare = qs('chartShare').getContext('2d');

  // Guardar ranks para o modal
  byVehicleRanks.byTrips = tripsTop.map(v=>v.veiculo);
  byVehicleRanks.byKm    = kmTop.map(v=>v.veiculo);

  charts.trips = new Chart(ctxTrips, {
    type:'bar',
    data:{
      labels: tripsTop.map(x=>x.veiculo),
      datasets:[{
        label:'Viagens',
        data: tripsTop.map(x=>x.viagens),
        backgroundColor: grad(ctxTrips,'#16a34aCC','#16a34a44'),
        borderColor:'#22c55e',
        borderWidth:1.2
      }]
    },
    options:{
      indexAxis:'y',
      responsive:true,
      plugins:{ legend:{ display:false }, tooltip:{ enabled:true } },
      scales:{ x:{ beginAtZero:true, grid:{ color:'#1f2a40' } }, y:{ grid:{ color:'#111827' } } },
      onClick:(evt, el)=>{
        if(!el?.length) return;
        const idx = el[0].index;
        const name = tripsTop[idx].veiculo;
        openModalForVehicle(name);
      }
    }
  });

  charts.km = new Chart(ctxKm, {
    type:'bar',
    data:{
      labels: kmTop.map(x=>x.veiculo),
      datasets:[{
        label:'Km',
        data: kmTop.map(x=>x.km),
        backgroundColor: grad(ctxKm,'#0ea5e9CC','#0ea5e944'),
        borderColor:'#38bdf8',
        borderWidth:1.2
      }]
    },
    options:{
      indexAxis:'y',
      responsive:true,
      plugins:{ legend:{ display:false }, tooltip:{ enabled:true } },
      scales:{ x:{ beginAtZero:true, grid:{ color:'#1f2a40' } }, y:{ grid:{ color:'#111827' } } },
      onClick:(evt, el)=>{
        if(!el?.length) return;
        const idx = el[0].index;
        const name = kmTop[idx].veiculo;
        openModalForVehicle(name);
      }
    }
  });

  charts.daily = new Chart(ctxDaily, {
    type:'line',
    data:{
      labels: byDay.map(x=>x.diaISO.substring(8,10)),
      datasets:[
        { label:'Viagens/dia', data: byDay.map(x=>x.viagens), yAxisID:'y1',
          borderColor:'#10b981', backgroundColor:'#10b98155', tension:.25, fill:true },
        { label:'Km/dia', data: byDay.map(x=>x.km), yAxisID:'y2',
          borderColor:'#94a3b8', backgroundColor:'#94a3b855', tension:.25, fill:true }
      ]
    },
    options:{
      responsive:true, interaction:{ mode:'index', intersect:false }, stacked:false,
      plugins:{ legend:{ labels:{ color:'#d1d5db' } } },
      scales:{
        y1:{ type:'linear', position:'left', beginAtZero:true, grid:{ color:'#1f2a40' }, ticks:{ color:'#9ca3af' } },
        y2:{ type:'linear', position:'right', beginAtZero:true, grid:{ drawOnChartArea:false, color:'#1f2a40' }, ticks:{ color:'#9ca3af' } },
        x:{ grid:{ color:'#111827' }, ticks:{ color:'#9ca3af' } }
      }
    }
  });

  // Share (donut) – top 6 + outros por KM
  const top6 = (metrics.byVehicle||[]).slice(0,6);
  const restKm = (metrics.byVehicle||[]).slice(6).reduce((a,b)=>a+(b.km||0),0);
  const labels = top6.map(v=>v.veiculo).concat(restKm>0?['Outros']:[]);
  const data   = top6.map(v=>v.km).concat(restKm>0?[restKm]:[]);
  charts.share = new Chart(ctxShare, {
    type:'doughnut',
    data:{
      labels, datasets:[{ data, backgroundColor:[
        '#16a34a','#0ea5e9','#f59e0b','#8b5cf6','#ef4444','#22c55e','#64748b'
      ]}]
    },
    options:{
      cutout:'55%', plugins:{ legend:{ position:'right', labels:{ color:'#d1d5db' } } }
    }
  });
}

function renderTable(byVehicle){
  const tb = qs('tbody'); tb.innerHTML = '';
  const rows = (byVehicle||[]).map(v=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${v.veiculo}</td>
                    <td style="text-align:right">${fmt.format(v.viagens)}</td>
                    <td style="text-align:right">${fmt.format(v.km)}</td>
                    <td style="text-align:right">${fmt.format(v.kmMedio)}</td>`;
    tr.addEventListener('click', ()=> openModalForVehicle(v.veiculo));
    return tr;
  });
  rows.forEach(r=>tb.appendChild(r));
}

function filterTable(){
  const q = qs('filtro').value.trim().toLowerCase();
  const trs = qs('tbody').querySelectorAll('tr');
  trs.forEach(tr=>{
    const name = tr.children[0].textContent.toLowerCase();
    tr.style.display = name.includes(q) ? '' : 'none';
  });
}

/* ================== MODAL ================== */
function openModalForVehicle(name){
  const m = metricsCache;
  if(!m || !m.byVehicle?.length) return;
  const item = m.byVehicle.find(v=>v.veiculo === name);
  if(!item) return;

  // Ranks
  const rankTrips = byVehicleRanks.byTrips.indexOf(name) >= 0 ? (byVehicleRanks.byTrips.indexOf(name)+1) : '—';
  const rankKm    = byVehicleRanks.byKm.indexOf(name)    >= 0 ? (byVehicleRanks.byKm.indexOf(name)+1)    : '—';

  // Share
  const totalKm = (m.totals?.kmRodados || 0);
  const shareKm = totalKm ? Math.round((item.km/totalKm)*1000)/10 : 0;

  qs('modalTitle').textContent = name;
  qs('mResumo').innerHTML = `
    <div class="muted">Período: ${String(m.period.month).padStart(2,'0')}/${m.period.year}</div>
    <div>Viagens: <b>${fmt.format(item.viagens)}</b> &nbsp;•&nbsp; Km: <b>${fmt.format(item.km)}</b> &nbsp;•&nbsp; Km/Viagem: <b>${fmt.format(item.kmMedio)}</b></div>
    <div>Participação nos Km do mês: <b>${shareKm}%</b></div>
  `;
  qs('mTrips').textContent = `Viagens: ${fmt.format(item.viagens)}`;
  qs('mKm').textContent    = `Km: ${fmt.format(item.km)}`;
  qs('mAvg').textContent   = `Média Km/Viagem: ${fmt.format(item.kmMedio)}`;
  qs('mRankTrips').textContent = `Rank Viagens: #${rankTrips}`;
  qs('mRankKm').textContent    = `Rank Km: #${rankKm}`;

  const backdrop = qs('modalBackdrop');
  backdrop.style.display = 'flex';
  backdrop.setAttribute('aria-hidden','false');
}
function closeModal(){
  const backdrop = qs('modalBackdrop');
  backdrop.style.display = 'none';
  backdrop.setAttribute('aria-hidden','true');
}
qs('btnClose').addEventListener('click', closeModal);
qs('btnClose2').addEventListener('click', closeModal);
qs('modalBackdrop').addEventListener('click', (e)=>{ if(e.target.id==='modalBackdrop') closeModal(); });
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

/* ================== EXPORT PNG ================== */
function downloadURI(uri, name){
  const a = document.createElement('a'); a.href = uri; a.download = name; document.body.appendChild(a); a.click(); a.remove();
}
function exportCharts(){
  if(!charts.trips) return;
  try{
    downloadURI(charts.trips.toBase64Image(), `top-viagens-${Date.now()}.png`);
    downloadURI(charts.km.toBase64Image(),    `top-km-${Date.now()}.png`);
    downloadURI(charts.daily.toBase64Image(), `evolucao-diaria-${Date.now()}.png`);
    downloadURI(charts.share.toBase64Image(), `participacao-km-${Date.now()}.png`);
  }catch(e){ alert('Não foi possível exportar no momento.'); }
}
qs('btnExport').addEventListener('click', exportCharts);

/* ================== INIT ================== */
function initSelectors(){
  const now = new Date(); const yNow = now.getFullYear(); const mNow = now.getMonth()+1;
  const selAno = qs('selAno'); selAno.innerHTML = '';
  for(let y=yNow-4;y<=yNow+1;y++){
    const opt = document.createElement('option'); opt.value=y; opt.textContent=y; selAno.appendChild(opt);
  }
  selAno.value = yNow; qs('selMes').value = mNow;
}
qs('btnAtualizar').addEventListener('click', update);
qs('filtro').addEventListener('input', filterTable);

async function update(){
  // coloca skeleton
  ['kpiTripsCard','kpiKmCard','kpiAvgCard','c1','c2','c3','c4'].forEach(id => qs(id).classList.add('skeleton'));
  destroyCharts();
  const y = Number(qs('selAno').value); const m = Number(qs('selMes').value);
  try{
    const r = await fetchMetrics(y,m);
    metricsCache = r;
    renderKPIs(r.totals);
    renderCharts(r);
    renderTable(r.byVehicle);
  }catch(e){
    setStatus('Erro: '+(e?.message||e));
  }finally{
    removeSkeleton();
  }
}

window.addEventListener('load', ()=>{
  initSelectors();
  update();
});
</script>
</body>
</html>
``
