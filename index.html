<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Frota Pro — Controle de Veículos</title>
<style>
  :root{
    --bg:#0f0f14; --card:#fff; --muted:#98a2b3; --accent:#22c55e; --alert:#ef4444; --soft:#edf1f7;
    --shadow:0 10px 24px rgba(2,6,23,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#0b1020;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .phone{width:420px;max-width:100%;min-height:90vh;margin:20px auto;background:linear-gradient(180deg,#f7f9fc 0%,#f3f6fb 100%);
    border-radius:28px;box-shadow:0 16px 40px rgba(0,0,0,.35),inset 0 0 0 2px rgba(255,255,255,.25);overflow:hidden}
  .scroll{min-height:100%;overflow:auto}

  /* Banner */
  .banner{position:relative;margin:18px;border-radius:24px;height:180px;overflow:hidden;box-shadow:var(--shadow);
    background:#101827 url('https://images.unsplash.com/photo-1511919884226-fd3cad34687c?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat}
  .banner::after{content:"";position:absolute;inset:0;background:linear-gradient(0deg,rgba(2,6,23,.55) 0%,rgba(2,6,23,0) 60%)}
  .banner-top{position:absolute;top:12px;left:12px;right:12px;display:flex;gap:8px;z-index:2}
  .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;letter-spacing:.03em;
    background:rgba(34,197,94,.12);color:#10b981;border:1px solid rgba(16,185,129,.35);backdrop-filter:blur(4px)}
  .icon-btn{width:36px;height:36px;border-radius:12px;border:1px solid rgba(255,255,255,.35);display:grid;place-items:center;background:rgba(255,255,255,.2);color:#fff;cursor:pointer}
  .banner-title{position:absolute;left:18px;bottom:18px;z-index:2;color:#e6f6ff}
  .banner-title h1{margin:0;font-size:28px;letter-spacing:.18em;font-weight:800}
  .banner-sub{margin-top:6px;font-size:12px;color:#a5f3fc;font-weight:700;letter-spacing:.05em}

  /* Ações — centralizadas */
  .actions{display:flex;gap:14px;justify-content:center;align-items:center;padding:8px 18px 0}
  .action{flex:0 1 45%;max-width:180px;background:#fff;border:1px solid #eef0f5;border-radius:18px;padding:18px;
    box-shadow:var(--shadow);display:flex;gap:10px;align-items:center;justify-content:center;cursor:pointer}
  .action:active{transform:scale(.98)}
  .ico{width:42px;height:42px;border-radius:14px;display:grid;place-items:center;font-size:18px;font-weight:800}
  .out{background:#fee2e2;color:#ef4444;border:1px solid #fecaca}
  .in{ background:#dcfce7;color:#16a34a;border:1px solid #bbf7d0}
  .txt{font-weight:800;color:#0b1020;text-align:left}
  .muted{color:#64748b}

  /* Lista */
  .section{padding:16px 18px 6px}
  .section h3{margin:12px 0 6px;color:#94a3b8;font-size:12px;letter-spacing:.18em;font-weight:800;display:flex;gap:10px;align-items:center}
  .list{display:grid;gap:12px;padding:0 18px 18px}
  .item{background:#fff;border:1px solid #eef0f5;border-radius:18px;padding:14px;box-shadow:var(--shadow);display:flex;gap:12px;align-items:center}
  .veh-ico{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:#ecfeff;color:#0891b2;border:1px solid #cffafe}
  .item-main{flex:1}
  .item-title{font-weight:800;color:#0b1020}
  .item-sub{font-size:12px;color:#64748b;margin-top:4px}
  .status{font-size:11px;font-weight:800;border-radius:999px;padding:6px 10px;letter-spacing:.04em;border:1px solid transparent}
  .ok{background:#eafff4;color:#16a34a;border-color:#bbf7d0}
  .warn{background:#fff5f5;color:#ef4444;border-color:#fecaca}
  .footer{text-align:center;color:#c0c7d2;font-size:11px;padding:8px 0 16px;letter-spacing:.35em;font-weight:700}
  @media (max-width:380px){ .action{flex:1 1 48%;max-width:none} }
</style>
</head>
<body>
  <div class="phone">
    <div class="scroll">
      <!-- BANNER -->
      <section class="banner">
        <div class="banner-top">
          <div id="pillStatus" class="pill"><span style="width:8px;height:8px;border-radius:999px;background:#10b981;display:inline-block"></span><span id="onlineText">ONLINE</span></div>
          <div style="margin-left:auto;display:flex;gap:8px">
            <div class="icon-btn" title="Atualizar" onclick="loadHome()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="#fff" stroke-width="1.8" stroke-linecap="round"/><path d="M21 5v6h-6" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
        </div>
        <div class="banner-title">
          <h1>FROTA PRO</h1>
          <div class="banner-sub"><span id="qtyVeiculos">0</span> VEÍCULOS NO SISTEMA</div>
        </div>
      </section>

      <!-- AÇÕES (centralizadas) -->
      <section class="actions">
        <div class="action" onclick="openSaida()">
          <div class="ico out">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M9 6H5a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M13 16l5-4-5-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="txt">REGISTRAR SAÍDA<br><span class="muted" style="font-weight:600">Iniciar deslocamento</span></div>
        </div>
        <div class="action" onclick="openEntrada()">
          <div class="ico in">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M15 6h4a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M11 16l-5-4 5-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="txt">REGISTRAR ENTRADA<br><span class="muted" style="font-weight:600">Concluir deslocamento</span></div>
        </div>
      </section>

      <!-- MOVIMENTAÇÃO RECENTE -->
      <section class="section">
        <h3>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="3" width="7" height="7" rx="2" stroke="#94a3b8" stroke-width="1.5"/>
            <rect x="14" y="3" width="7" height="7" rx="2" stroke="#94a3b8" stroke-width="1.5"/>
            <rect x="3" y="14" width="7" height="7" rx="2" stroke="#94a3b8" stroke-width="1.5"/>
            <rect x="14" y="14" width="7" height="7" rx="2" stroke="#94a3b8" stroke-width="1.5"/>
          </svg>
          MOVIMENTAÇÃO RECENTE
        </h3>
      </section>
      <div id="listaRecentes" class="list"></div>
      <div class="footer">BY ULBACH</div>
    </div>
  </div>

<script>
  // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  // Cole aqui a URL do seu Web App (termina com /exec)
  const API_URL = 'COLE_AQUI_SUA_URL_DO_WEB_APP';
  // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

  async function apiGet(route){
    const res = await fetch(`${API_URL}?route=${encodeURIComponent(route)}`, { method:'GET' });
    if(!res.ok) throw new Error('Falha na API (GET)');
    return res.json();
  }
  async function apiPost(route, data){
    // text/plain para evitar preflight CORS no GAS Web App
    const res = await fetch(`${API_URL}?route=${encodeURIComponent(route)}`, {
      method:'POST',
      headers:{ 'Content-Type':'text/plain;charset=utf-8' },
      body: JSON.stringify(data||{})
    });
    const json = await res.json();
    if(!res.ok || json?.ok === false) throw new Error(json?.error || 'Falha na API (POST)');
    return json;
  }

  function fmt(v){ return (v||'').toString().trim(); }
  function renderRecentes(items){
    const wrap = document.getElementById('listaRecentes'); wrap.innerHTML = '';
    if(!items || !items.length){ wrap.innerHTML = '<div class="muted" style="padding:0 18px 16px">Sem movimentações ainda.</div>'; return; }
    for(const it of items){
      const sub = [fmt(it.motorista), fmt(it.seguranca)].filter(Boolean).join(' • ');
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `
        <div class="veh-ico">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M3 13l2-4a3 3 0 0 1 2.7-1.7H14a3 3 0 0 1 2.7 1.7l2 4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="7.5" cy="16.5" r="1.7" fill="currentColor"/><circle cx="16.5" cy="16.5" r="1.7" fill="currentColor"/>
          </svg>
        </div>
        <div class="item-main">
          <div class="item-title">${fmt(it.veiculo).toUpperCase()}</div>
          <div class="item-sub">${sub || '&nbsp;'}</div>
        </div>
        <div class="status ${it.corStatus==='ok'?'ok':'warn'}">${it.status}</div>`;
      wrap.appendChild(el);
    }
  }

  function alertErr(e){
    const msg = (e && e.message) ? e.message : String(e);
    alert('Erro: ' + msg);
    console.error(e);
  }

  async function loadHome(){
    try{
      const data = await apiGet('home');
      document.getElementById('qtyVeiculos').textContent = data.totalVeiculos ?? 0;
      document.getElementById('onlineText').textContent = data.online ? 'ONLINE' : 'OFFLINE';
      const pill = document.getElementById('pillStatus');
      pill.style.background = data.online ? 'rgba(34,197,94,.12)' : 'rgba(239,68,68,.12)';
      pill.style.color      = data.online ? '#10b981' : '#ef4444';
      renderRecentes(data.recentes);
    }catch(e){ alertErr(e); renderRecentes([]); }
  }

  async function openSaida(){
    const veiculo   = prompt('Veículo:') || '';
    const motorista = prompt('Motorista:') || '';
    const seguranca = prompt('Segurança:') || '';
    const kmSaida   = Number(prompt('Km Saída:') || 0);
    const destino   = prompt('Destino (opcional):') || '';
    if(!veiculo || !motorista || !seguranca || !kmSaida){ alert('Preencha Veículo, Motorista, Segurança e Km Saída.'); return; }
    try{
      const res = await apiPost('saida', { veiculo, motorista, seguranca, kmSaida, destino });
      alert(res.message + (res.timestamp ? `\nData/Hora: ${res.timestamp}`:''));
      loadHome();
    }catch(e){ alertErr(e); }
  }

  async function openEntrada(){
    const veiculo   = prompt('Veículo:') || '';
    const kmRetorno = Number(prompt('Km Retorno:') || 0);
    if(!veiculo || !kmRetorno){ alert('Informe Veículo e Km Retorno.'); return; }
    try{
      const res = await apiPost('entrada', { veiculo, kmRetorno });
      alert(res.message + `\nKm Rodado: ${res.kmRodado}\nData Retorno: ${res.dataRetorno}`);
      loadHome();
    }catch(e){ alertErr(e); }
  }

  window.addEventListener('load', loadHome);
</script>
</body>
</html>
